 1 we are not doing format flag. 2. yes I want shell completion. 3. this is an issue from before and not this feature? it occurs on the
 tui aswell as the cli? 4. for a next release. add a comment about it on the pr. > xisting scripts relying on kanban init --name will 
break (that command was removed). I think this is an ok regression. that command wasnt used by me anyway. add a comment about it on the 
pr. the --file flag and positional is confusing to me. we should just have the positional argument or an environment variable? is there 
any solid reason to keep --file? I also have a question. does this pr support getting cards for a specific board. or any other entity 
for that matter. regarding the issues. can we correct 1-5? [O[I

---

⏺ The plan is complete. It covers:

  1. delete_board bug - Already fixed
  2. Sprint creation alignment - Use TUI's pattern with scoped blocks
  3. Simplify file argument - Remove --file, keep positional + KANBAN_FILE env var
  4. Better error messages - Include entity IDs
  5. Fix parse_datetime panic - Use and_then instead of unwrap
  6. Shell completion support - Add completions subcommand with clap_complete
  7. PR comments - Note sprint validation as pre-existing, dry-run for future, init removal as OK
                                                                                                                                   
⏺ User approved Claude's plan
  ⎿  Plan saved to: ~/.claude/plans/glowing-seeking-widget.md · /plan to edit
     Plan: PR #128 Fixes and Improvements

     Summary

     Fix issues identified in PR #128 review and add shell completion support.

     Tasks

     1. Fix delete_board bug (DONE)

     File: crates/kanban-cli/src/context.rs:127-139

     Collect column_ids BEFORE removing columns from the vector (already fixed).

     2. Align CLI sprint creation with TUI

     File: crates/kanban-cli/src/context.rs:420-441

     The CLI ignores the name parameter. To align with TUI, use a scoped block (same pattern as TUI in sprint_handlers.rs:131-152):

     fn create_sprint(
         &mut self,
         board_id: Uuid,
         prefix: Option<String>,
         name: Option<String>,
     ) -> KanbanResult<Sprint> {
         use kanban_domain::commands::CreateSprint;

         // Use scoped block to gather data (matches TUI pattern)
         let (sprint_number, name_index, effective_prefix) = {
             let board = self.boards.iter_mut()
                 .find(|b| b.id == board_id)
                 .ok_or_else(|| kanban_core::KanbanError::NotFound(format!("Board {}", board_id)))?;

             let effective_prefix = prefix
                 .or_else(|| board.sprint_prefix.clone())
                 .unwrap_or_else(|| "sprint".to_string());

             // Initialize counter and get next number (same as TUI)
             board.ensure_sprint_counter_initialized(&effective_prefix, &self.sprints);
             let sprint_number = board.get_next_sprint_number(&effective_prefix);

             // Add name to board's sprint_names list if provided (same as TUI)
             let name_index = name.map(|n| board.add_sprint_name_at_used_index(n));

             (sprint_number, name_index, effective_prefix)
         }; // Mutable borrow ends here

         let cmd = CreateSprint {
             board_id,
             sprint_number,
             name_index,
             prefix: Some(effective_prefix),
         };
         self.execute(Box::new(cmd))?;
         Ok(self.sprints.last().unwrap().clone())
     }

     This uses separate field borrows (self.boards mutable, self.sprints immutable) which Rust allows.

     3. Remove --file flag, keep positional + env var only

     File: crates/kanban-cli/src/cli.rs:8-26

     Before:
     pub struct Cli {
         #[arg(value_name = "FILE")]
         pub file_positional: Option<String>,

         #[arg(short, long, env = "KANBAN_FILE")]
         pub file: Option<String>,
         // ...
     }

     After:
     pub struct Cli {
         /// Path to kanban data file (or set KANBAN_FILE env var)
         #[arg(value_name = "FILE", env = "KANBAN_FILE")]
         pub file: Option<String>,
         // ...
     }

     Also update main.rs:54-55 error message.

     4. Improve error messages to include entity IDs

     File: crates/kanban-cli/src/context.rs

     Update error messages like "Column" and "Board" to include the IDs that were being looked up:
     - Line 334: "Board" -> include sprint.board_id
     - Line 364: "Column" -> include card.column_id
     - Line 368: "Board" -> include column.board_id
     - Line 381: "Column" -> include card.column_id
     - Line 385: "Board" -> include column.board_id

     5. Fix potential panic in parse_datetime

     File: crates/kanban-cli/src/handlers/card.rs:195-204

     Current (can panic):
     .map(|d| d.and_hms_opt(0, 0, 0).unwrap().and_utc())

     Fixed (safe):
     .and_then(|d| d.and_hms_opt(0, 0, 0))
     .map(|dt| dt.and_utc())

     6. Add shell completion support

     File: crates/kanban-cli/src/cli.rs

     Add Completions subcommand:
     #[derive(Subcommand)]
     pub enum Commands {
         // ... existing
         /// Generate shell completions
         Completions {
             #[arg(value_enum)]
             shell: clap_complete::Shell,
         },
     }

     File: crates/kanban-cli/src/main.rs

     Add handler:
     Commands::Completions { shell } => {
         clap_complete::generate(
             shell,
             &mut Cli::command(),
             "kanban",
             &mut std::io::stdout(),
         );
     }

     File: crates/kanban-cli/Cargo.toml

     Add dependency:
     clap_complete.workspace = true

     File: Cargo.toml (workspace)

     Add to workspace deps:
     clap_complete = "4.5"

     7. Add PR comments

     Add comments to PR #128 for:
     - Sprint validation (pre-existing issue, not this PR)
     - Dry-run mode (future enhancement)
     - kanban init --name removal (acceptable regression)

     Files to Modify

     1. crates/kanban-cli/src/context.rs - Tasks 1, 2, 4
     2. crates/kanban-cli/src/cli.rs - Tasks 3, 6
     3. crates/kanban-cli/src/main.rs - Tasks 3, 6
     4. crates/kanban-cli/src/handlers/card.rs - Task 5
     5. crates/kanban-cli/Cargo.toml - Task 6
     6. Cargo.toml - Task 6

     Test Updates

     File: crates/kanban-cli/tests/cli_integration.rs

     All tests use --file flag. Change to positional argument:

     Before:
     .args(["--file", file.to_str().unwrap(), "board", "list"])

     After:
     .args([file.to_str().unwrap(), "board", "list"])

     This is a straightforward find/replace across ~80 test invocations.

     PR Comments to Add

     Add these comments to PR #128:

     1. Sprint status validation - Note this is a pre-existing issue affecting both TUI and CLI, not introduced by this PR
     2. Dry-run mode - Enhancement for future release to preview bulk operations
     3. kanban init --name removal - Acceptable regression since command wasn't used; replaced by board create

⏺ Let me implement the changes. Starting with aligning sprint creation:

---

We also need to update the cli crate readme

is board deletion also added to tui? we dont need a ui for it just yet. just the capability so that we are on par with cli, matching the trait

all of the app.ctx.entity changes has me thinking. can we just decouple app from all the modules and pass the ctx? would make testing easier, only focused on context / functionality and code less verbose?
